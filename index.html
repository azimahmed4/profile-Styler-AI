<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Profile Styler</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; text-align: center; padding: 40px; background: #0f172a; color: white; }
        .container { background: #1e293b; padding: 40px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); display: inline-block; border: 1px solid #334155; }
        h1 { margin-bottom: 10px; background: linear-gradient(90deg, #38bdf8, #818cf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        #file-upload { margin: 20px 0; padding: 10px; color: #94a3b8; }
        .btn { background: #3b82f6; color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn:hover { background: #2563eb; transform: scale(1.05); }
        #output { margin-top: 30px; border-radius: 50%; box-shadow: 0 0 30px rgba(59, 130, 246, 0.5); display: none; width: 300px; height: 300px; object-fit: cover; }
        #status { margin-top: 20px; color: #94a3b8; font-size: 14px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Profile Magic AI</h1>
        <p>Generate glowing radial effects automatically</p>
        
        <input type="file" id="file-upload" accept="image/*">
        <br>
        <button id="magic-btn" class="btn" py-click="apply_ai_style">Generate Glow ✨</button>
        
        <div id="status">System starting...</div>
        <img id="output">
    </div>

    <py-config>
        packages = ["Pillow"]
    </py-config>

    <script type="py">
        from pyscript import document
        from PIL import Image, ImageOps, ImageDraw, ImageFilter
        import io, base64, js

        document.getElementById("status").innerHTML = "Ready for magic!"

        async def apply_ai_style(event):
            status = document.getElementById("status")
            file_list = document.getElementById("file-upload").files
            
            if not file_list:
                status.innerHTML = "Error: Select a photo first!"
                return

            status.innerHTML = "Processing with Python AI..."
            
            # Read image
            file = await file_list.item(0).arrayBuffer()
            user_img = Image.open(io.BytesIO(file.to_bytes())).convert("RGBA")

            # 1. Square Crop & Resize
            size = (800, 800)
            user_img = ImageOps.fit(user_img, size)

            # 2. Create Radial Glow Background
            # This creates the effect you showed in the second picture
            base = Image.new("RGBA", size, (15, 23, 42, 255))
            draw = ImageDraw.Draw(base)
            
            # Drawing a glowing circle
            for i in range(100):
                alpha = int(255 * (1 - i/100))
                draw.ellipse([i, i, 800-i, 800-i], outline=(56, 189, 248, alpha), width=2)

            # 3. Create Circle Mask for User Image
            mask = Image.new("L", size, 0)
            draw_mask = ImageDraw.Draw(mask)
            draw_mask.ellipse([40, 40, 760, 760], fill=255)
            
            # Apply Circular Cut
            output_img = Image.new("RGBA", size, (0, 0, 0, 0))
            output_img.paste(user_img, (0,0), mask=mask)

            # 4. Add Glowing Border
            glow_border = Image.new("RGBA", size, (0,0,0,0))
            draw_glow = ImageDraw.Draw(glow_border)
            draw_glow.ellipse([35, 35, 765, 765], outline=(0, 191, 255, 255), width=15)
            # Soften the glow
            glow_border = glow_border.filter(ImageFilter.GaussianBlur(5))
            
            # Combine everything
            final = Image.alpha_composite(base, glow_border)
            final = Image.alpha_composite(final, output_img)

            # Show Result
            buffered = io.BytesIO()
            final.save(buffered, format="PNG")
            img_str = base64.b64encode(buffered.getvalue()).decode()

            out_element = document.getElementById("output")
            out_element.src = f"data:image/png;base64,{img_str}"
            out_element.style.display = "inline-block"
            status.innerHTML = "Style Applied Successfully! ✅"

    </script>
</body>
</html>
