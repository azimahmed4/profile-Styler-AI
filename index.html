<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>Profile Style Snap</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; background: #f4f4f9; }
        #output { margin-top: 20px; border: 2px solid #ddd; max-width: 400px; }
        .upload-box { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: inline-block; }
    </style>
</head>
<body>

    <div class="upload-box">
        <h2>ЁЯОи ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржкрж┐ржХржЪрж╛рж░ рж╕рзНржЯрж╛ржЗрж▓рж╛рж░</h2>
        <p>ржкрж╛ржЗржержи ржжрж┐рзЯрзЗ рж╕рж░рж╛рж╕рж░рж┐ ржЧрж┐ржЯрж╣рж╛ржмрзЗ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ</p>
        <input type="file" id="file-upload" accept="image/*">
        <br><br>
        <button id="magic-btn" py-click="apply_style">ржорзНржпрж╛ржЬрж┐ржХ рж╕рзНржЯрж╛ржЗрж▓ тЬи</button>
        <br>
        <div id="status">ржкрж╛ржЗржержи рж▓рзЛржб рж╣ржЪрзНржЫрзЗ, ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи...</div>
        <img id="output">
    </div>

    <py-config>
        packages = ["Pillow"]
    </py-config>

    <script type="py">
        from pyscript import document
        from PIL import Image, ImageOps
        import io
        import base64
        import js

        # рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржЖржкржбрзЗржЯ
        document.getElementById("status").innerHTML = "ржкрж╛ржЗржержи рж░рзЗржбрж┐! ржЫржмрж┐ ржЖржкрж▓рзЛржб ржХрж░рзБржиред"

        async def apply_style(event):
            status = document.getElementById("status")
            status.innerHTML = "ржкрзНрж░рж╕рзЗрж╕рж┐ржВ ржЪрж▓ржЫрзЗ..."
            
            # ржлрж╛ржЗрж▓ рж░рж┐ржб ржХрж░рж╛
            file_list = document.getElementById("file-upload").files
            if not file_list:
                status.innerHTML = "ржжрзЯрж╛ ржХрж░рзЗ ржПржХржЯрж┐ ржЫржмрж┐ рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзБржи!"
                return

            # ржЬрж╛ржнрж╛рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржерзЗржХрзЗ ржлрж╛ржЗрж▓ ржбрж╛ржЯрж╛ ржирзЗржУрзЯрж╛
            file = await file_list.item(0).arrayBuffer()
            img_bytes = file.to_bytes()
            
            # Pillow ржжрж┐рзЯрзЗ ржЗржорзЗржЬ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ
            img = Image.open(io.BytesIO(img_bytes)).convert("RGBA")
            
            # ржЙржжрж╛рж╣рж░ржг: ржПржХржЯрж┐ ржирзАрж▓ ржмрж░рзНржбрж╛рж░ ржмрж╛ рж╕рзНржЯрж╛ржЗрж▓ ржпрзЛржЧ ржХрж░рж╛ (ржЖржкржирж┐ ржПржЦрж╛ржирзЗ ржлрзНрж░рзЗржорзЗрж░ рж▓рж┐ржЩрзНржХржУ ржпрзЛржЧ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи)
            styled_img = ImageOps.expand(img, border=30, fill='blue')
            
            # ржЖржЙржЯржкрзБржЯ ржжрзЗржЦрж╛ржирзЛрж░ ржЬржирзНржп ржПржиржХрзЛржб ржХрж░рж╛
            buffered = io.BytesIO()
            styled_img.save(buffered, format="PNG")
            img_str = base64.b64encode(buffered.getvalue()).decode()
            
            document.getElementById("output").src = f"data:image/png;base64,{img_str}"
            status.innerHTML = "рж╕рзНржЯрж╛ржЗрж▓ ржХржоржкрзНрж▓рж┐ржЯ! тЬЕ"
    </script>

</body>
</html>
